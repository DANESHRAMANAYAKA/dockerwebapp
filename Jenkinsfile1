pipeline {
    agent any
    stages {
        stage("Create tmp YAML file"){
            steps{
                sh 'cp deployment-definition.yml deployment-definition-tmp.yml'  
            }
        }
        stage('Read YAML file') {
            steps{
               script
               {
              
                    def dockerwebappname = 'dockerwebapp'
                    def filename = 'deployment-definition-tmp.yml'
                    def data = readYaml file: filename

                    // Change something in the file
                    ///data.spec.template.spec.containers.name = 'dockerwebapp'
                    ///echo data.spec.template.spec.containers.name.toString()
                     
                    

                    sh "rm $filename"
                    writeYaml file: filename, data: data
                    ///////////
                    def amap = [apiVersion:apps/v1, kind:Deployment, metadata:[name:frontend, labels:[app:mywebsite, tier:frontend]], spec:[replicas:4, template:[metadata:[name:myapp-pod, labels:[app:myapp]], spec:[containers:[[name:nginx, image:nginx]]]], selector:[matchLabels:[app:myapp]]]]
                    writeYaml file: 'datas.yaml', data: amap
                    
                    //////////////////////
                   
 
            
               
               
                
                
                
                
                }
            }
        
        }
        stage('Build image') {
            steps {
                echo 'Starting to build docker image'

                script {
                    def customImage = docker.build("dockerwebapp")
                  
                }
            }
        }
    }
}
